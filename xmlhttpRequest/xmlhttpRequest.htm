<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>XMLHttpRequest上传文件进度实现</title>
    <script type="text/javascript">
        var xhr;
        //上传文件方法
        function downLoadFile() {
            var url = "http://localhost/phpStudy/xmlhttpRequest/jiangnanStyleAVC_H_AAC1080P.mp4"; // 接收上传文件的后台地址
            xhr = new XMLHttpRequest();  // XMLHttpRequest 对象
            xhr.open("GET", url, true); //post方式，url为服务器请求地址，true 该参数规定请求是否异步处理。


            xhr.onerror = uploadFailed; //请求失败
            xhr.onreadystatechange = dataCallback;
            xhr.upload.onprogress = progressFunction;//【上传进度调用方法实现】
            xhr.setRequestHeader("Range", "bytes=10240-10480");

            xhr.responseType = "arraybuffer";

            xhr.send(""); //开始上传，发送form数据
        }
        //上传进度实现方法，上传过程中会频繁调用该方法
        function progressFunction(evt) {
            
            if (evt.lengthComputable) {
                alert(evt.loaded + "  " + evt.total);
            }

               // progress.innerHTML = Math.round(100* e.loaded/ e.total) + \'%\';

        }

        function dataCallback(evt) {
            alert(xhr.readyState);

            if (xhr.readyState < 4) {
                return;
            };
            if (xhr.status !== 200 && xhr.status !== 206) {
                alert('the status code is not ok' + xhr.status);
                return;
            };
            alert(xhr.response);
/*
            var arrayBuffer = oReq.response; // 注意:不是oReq.responseText
            if (arrayBuffer) {
                var byteArray = new Uint8Array(arrayBuffer);
                for (var i = 0; i < byteArray.byteLength; i++) {
                    // 对数组中的每个字节进行操作
                }
            }
*/
        }

        //上传成功响应
        function uploadComplete(evt) {
            //服务断接收完文件返回的结果
            //alert(evt.target.responseText);
            alert("上传成功！");
        }
        //上传失败
        function uploadFailed(evt) {
            //alert(evt.target.responseText);
            alert("上传失败！");
        }
        //取消上传
        function cancleUploadFile() {
            xhr.abort();
        }
    </script>
</head>
<body>
    <br /><br />
    <input type="button" onclick="downLoadFile()" value="上传" />
</body>
</html>